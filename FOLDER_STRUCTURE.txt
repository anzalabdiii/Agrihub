AgriLink Hub - Complete Folder Structure
========================================

Agrilink_Hub/
â”‚
â”œâ”€â”€ ğŸ“„ README.md                      # Main documentation
â”œâ”€â”€ ğŸ“„ ARCHITECTURE.md                # System architecture & workflows
â”œâ”€â”€ ğŸ“„ COMPONENT_GUIDE.md             # Frontend component examples
â”œâ”€â”€ ğŸ“„ DEPLOYMENT.md                  # Production deployment guide
â”œâ”€â”€ ğŸ“„ QUICK_START.md                 # Quick setup guide
â”œâ”€â”€ ğŸ“„ FOLDER_STRUCTURE.txt           # This file
â”‚
â”œâ”€â”€ ğŸ“ backend/                       # Python Flask Backend
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ config.py                  # Flask configuration (dev/prod/test)
â”‚   â”œâ”€â”€ ğŸ“„ run.py                     # Application entry point + CLI commands
â”‚   â”œâ”€â”€ ğŸ“„ requirements.txt           # Python dependencies
â”‚   â”œâ”€â”€ ğŸ“„ .env.example               # Environment variables template
â”‚   â”œâ”€â”€ ğŸ“„ .gitignore                 # Git ignore rules
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ app/                       # Main application package
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py            # App factory (create_app)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ models/                # SQLAlchemy Database Models
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py        # Models exports
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ user.py            # User model (admin/farmer/buyer)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ farmer_profile.py  # Farmer profile & farm details
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ buyer_profile.py   # Buyer profile & delivery info
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ category.py        # Product categories
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ farmer_product.py  # Products with approval status
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ product_image.py   # Product images
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ cart.py            # Shopping cart
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ cart_item.py       # Cart items
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ order.py           # Orders with status
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ order_item.py      # Order line items
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ activity_log.py    # Activity logging/audit trail
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ routes/                # API Endpoints (Blueprints)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ auth.py            # Login, signup, refresh, logout
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ admin.py           # Admin operations (create farmer, approve orders)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ farmer.py          # Farmer operations (CRUD products, view orders)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ buyer.py           # Buyer operations (profile, orders)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ products.py        # Public product listing & search
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ cart.py            # Cart operations (add, update, remove)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ orders.py          # Order confirmation
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ upload.py          # Image upload endpoints
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/                 # Utility Functions
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ __init__.py        # Utils exports
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ decorators.py      # Role-based access decorators
â”‚   â”‚       â””â”€â”€ ğŸ“„ helpers.py         # Helper functions (IP, file validation)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ migrations/                # Database migrations (generated by Flask-Migrate)
â”‚   â”‚   â””â”€â”€ ğŸ“ versions/
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ uploads/                   # Uploaded product images
â”‚       â””â”€â”€ (generated files)
â”‚
â””â”€â”€ ğŸ“ frontend/                      # React + Vite Frontend
    â”‚
    â”œâ”€â”€ ğŸ“„ package.json               # NPM dependencies
    â”œâ”€â”€ ğŸ“„ vite.config.js             # Vite configuration
    â”œâ”€â”€ ğŸ“„ tailwind.config.js         # Tailwind CSS config
    â”œâ”€â”€ ğŸ“„ postcss.config.js          # PostCSS config
    â”œâ”€â”€ ğŸ“„ index.html                 # HTML entry point
    â”œâ”€â”€ ğŸ“„ .env.example               # Environment variables
    â”œâ”€â”€ ğŸ“„ .gitignore                 # Git ignore rules
    â”‚
    â”œâ”€â”€ ğŸ“ public/                    # Static assets
    â”‚   â””â”€â”€ vite.svg
    â”‚
    â””â”€â”€ ğŸ“ src/                       # Source code
        â”‚
        â”œâ”€â”€ ğŸ“„ main.jsx               # React entry point
        â”œâ”€â”€ ğŸ“„ App.jsx                # Main app with routing & protection
        â”œâ”€â”€ ğŸ“„ index.css              # Tailwind CSS imports & custom styles
        â”‚
        â”œâ”€â”€ ğŸ“ pages/                 # Page Components
        â”‚   â”‚
        â”‚   â”œâ”€â”€ ğŸ“ auth/              # Authentication Pages
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Login.jsx      # Login page (all roles)
        â”‚   â”‚   â””â”€â”€ ğŸ“„ Signup.jsx     # Buyer signup page
        â”‚   â”‚
        â”‚   â”œâ”€â”€ ğŸ“ admin/             # Admin Dashboard Pages
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Dashboard.jsx          # Admin dashboard with stats
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CreateFarmer.jsx       # Create farmer account form
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ManageFarmers.jsx      # List all farmers
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ManageBuyers.jsx       # List all buyers
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PendingProducts.jsx    # Approve/reject products
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ PendingOrders.jsx      # Approve/decline orders
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ManageCategories.jsx   # CRUD categories
        â”‚   â”‚   â””â”€â”€ ğŸ“„ ActivityLogs.jsx       # View activity logs
        â”‚   â”‚
        â”‚   â”œâ”€â”€ ğŸ“ farmer/            # Farmer Dashboard Pages
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Dashboard.jsx          # Farmer analytics
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ MyProducts.jsx         # List farmer's products
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CreateProduct.jsx      # Create product form
        â”‚   â”‚   â”œâ”€â”€ ğŸ“„ EditProduct.jsx        # Edit product form
        â”‚   â”‚   â””â”€â”€ ğŸ“„ Orders.jsx             # View approved orders
        â”‚   â”‚
        â”‚   â””â”€â”€ ğŸ“ buyer/             # Buyer Dashboard Pages
        â”‚       â”œâ”€â”€ ğŸ“„ Dashboard.jsx          # Buyer dashboard
        â”‚       â”œâ”€â”€ ğŸ“„ ProductListing.jsx     # Browse products with filters
        â”‚       â”œâ”€â”€ ğŸ“„ ProductDetail.jsx      # Product details page
        â”‚       â”œâ”€â”€ ğŸ“„ Cart.jsx               # Shopping cart
        â”‚       â”œâ”€â”€ ğŸ“„ Orders.jsx             # Order history
        â”‚       â””â”€â”€ ğŸ“„ OrderDetail.jsx        # Order details
        â”‚
        â”œâ”€â”€ ğŸ“ components/            # Reusable Components
        â”‚   â”œâ”€â”€ ğŸ“„ DashboardLayout.jsx        # Dashboard layout with sidebar
        â”‚   â”œâ”€â”€ ğŸ“„ Card.jsx                   # Card container
        â”‚   â”œâ”€â”€ ğŸ“„ Badge.jsx                  # Status badges
        â”‚   â”œâ”€â”€ ğŸ“„ Table.jsx                  # Data table
        â”‚   â”œâ”€â”€ ğŸ“„ Modal.jsx                  # Modal dialog
        â”‚   â”œâ”€â”€ ğŸ“„ SearchInput.jsx            # Debounced search
        â”‚   â”œâ”€â”€ ğŸ“„ Pagination.jsx             # Pagination controls
        â”‚   â”œâ”€â”€ ğŸ“„ ImageUpload.jsx            # Image upload widget
        â”‚   â”œâ”€â”€ ğŸ“„ ProductCard.jsx            # Product card
        â”‚   â””â”€â”€ ğŸ“„ (create as needed)
        â”‚
        â”œâ”€â”€ ğŸ“ store/                 # Zustand State Management
        â”‚   â”œâ”€â”€ ğŸ“„ authStore.js       # Auth state (user, login, logout)
        â”‚   â”œâ”€â”€ ğŸ“„ productStore.js    # Products & filters
        â”‚   â”œâ”€â”€ ğŸ“„ cartStore.js       # Cart state
        â”‚   â””â”€â”€ ğŸ“„ notificationStore.js # Notifications
        â”‚
        â””â”€â”€ ğŸ“ services/              # API Layer
            â””â”€â”€ ğŸ“„ api.js             # Axios instance + all API methods


KEY FILES EXPLAINED
===================

BACKEND:
--------
âœ… config.py              - Environment configs (dev/prod/test)
âœ… run.py                 - Flask app runner + CLI commands (seed_admin, seed_categories)
âœ… app/__init__.py        - App factory with blueprint registration
âœ… app/models/            - 11 database models with relationships
âœ… app/routes/admin.py    - â­ STOCK DEDUCTION LOGIC in approve_order()
âœ… app/utils/decorators.py - @admin_required, @farmer_required, @buyer_required

FRONTEND:
---------
âœ… App.jsx                - Routing with ProtectedRoute & PublicRoute
âœ… store/authStore.js     - Login/logout with token management
âœ… store/cartStore.js     - Cart operations
âœ… services/api.js        - API service layer with auto token refresh
âœ… pages/auth/Login.jsx   - Universal login (redirects by role)
âœ… pages/auth/Signup.jsx  - Buyer self-registration


CRITICAL WORKFLOWS
==================

1ï¸âƒ£  FARMER CREATION
   Admin â†’ POST /api/admin/farmers/create
   â†’ Creates User (role='farmer')
   â†’ Creates FarmerProfile
   â†’ Logs activity

2ï¸âƒ£  PRODUCT APPROVAL
   Farmer â†’ POST /api/farmer/products (is_approved=False)
   Admin â†’ PATCH /api/admin/products/:id/approve
   â†’ Sets is_approved=True
   â†’ Product becomes public

3ï¸âƒ£  ORDER APPROVAL + STOCK DEDUCTION â­
   Buyer â†’ POST /api/orders/confirm
   â†’ Creates Order (status='pending')
   â†’ Creates OrderItems

   Admin â†’ PATCH /api/admin/orders/:id/approve
   â†’ Validates stock availability
   â†’ Deducts stock: product.quantity -= ordered_quantity
   â†’ Sets is_out_of_stock=True if quantity reaches 0
   â†’ Logs all stock deductions
   â†’ Sets order.status='approved'
   â†’ Farmer can now view order


STOCK DEDUCTION CODE
=====================
Location: backend/app/routes/admin.py:approve_order()

for item in order.items:
    product = FarmerProduct.query.get(item.product_id)

    # Validate stock
    if product.quantity < item.quantity:
        return error('Insufficient stock')

    # Deduct stock
    product.update_stock(-item.quantity)  # Handles out_of_stock flag

    # Log deduction
    ActivityLog.log_activity(
        user_id=admin_id,
        action='stock_deduction',
        description=f'Deducted {item.quantity} from {product.name}'
    )


NEXT STEPS
==========

1. Set up PostgreSQL database
2. Run backend: pip install -r requirements.txt && python run.py
3. Run frontend: npm install && npm run dev
4. Login as admin (admin@agrilink.com / admin123)
5. Create farmer accounts
6. Test the complete workflow

NOTES:
- All authentication pages are complete
- Routing is set up with role-based protection
- API service layer is ready with auto token refresh
- You need to implement the specific dashboard page UIs
- Refer to COMPONENT_GUIDE.md for component examples
- Stock deduction is fully implemented in the backend
